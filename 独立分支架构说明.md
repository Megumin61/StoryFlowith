# 独立分支架构功能说明

## 概述

独立分支架构是StoryFlow系统中的一个重要功能，允许用户在故事创作过程中创建多个独立的故事分支，每个分支节点都是独立的，可以继续创建新的分支。

## 主要功能

### 1. 探索节点创建
- 在主线故事的任何位置，用户可以创建探索节点
- 探索节点用于收集用户的想法和探索方向
- 支持拖拽关键词气泡到探索区域

### 2. 独立分支生成
- 基于探索节点的内容，系统可以生成多个独立的故事分支
- 每个分支节点都是完全独立的，不依赖于探索节点
- 分支节点可以继续创建新的探索节点和分支

### 3. 平行布局
- 主线故事保持在中央水平线上
- 分支故事在平行的水平线上展开
- 每个分支水平线可以包含多个连续的节点
- 分支之间保持适当的垂直间距

### 4. 分支标识
- 每个分支节点都有明确的分支标识
- 显示"分支 1"、"分支 2"等标识
- 使用蓝色圆点图标区分分支节点

### 5. 连接线样式
- **主线连接**：灰色实线，表示主线故事的发展
- **分支内连接**：绿色实线，表示同一分支内节点的连接
- **无探索连接**：探索节点不再连接到分支节点

### 6. 独立发展
- 每个分支节点都可以调出情境探索面板
- 分支节点可以继续创建新的分支
- 每个分支都是独立的故事线

## 使用方法

### 创建探索节点
1. 在主线故事中选择一个节点
2. 点击"探索场景"按钮
3. 在探索节点中输入探索内容
4. 可以拖拽关键词气泡到探索区域

### 生成独立分支
1. 在探索节点中输入探索内容
2. 点击"情景构思"按钮
3. 系统会生成多个分支选项
4. 选择合适的分支进行创建
5. 分支节点创建后是独立的，不再与探索节点连接

### 管理分支
1. 分支节点会自动布局在平行水平线上
2. 可以在分支内继续添加节点
3. 分支节点会显示分支标识
4. 每个分支节点都可以继续创建新的探索节点

### 分支独立发展
1. 点击任何分支节点
2. 使用"情景探索"功能创建新的探索节点
3. 新创建的探索节点属于该分支
4. 可以继续生成新的分支

## 技术实现

### 数据结构
```javascript
// 探索节点
{
  id: "exploration_123",
  explorationData: {
    isExplorationNode: true,
    explorationText: "探索内容",
    bubbleData: [...]
  },
  connections: [] // 不再连接到分支节点
}

// 独立分支节点
{
  id: "frame_456",
  branchData: {
    branchId: "branch_exploration_123_0_1234567890",
    parentNodeId: "exploration_123", // 记录创建它的探索节点
    explorationText: "探索内容",
    bubbleData: [...],
    branchIndex: 0,
    branchLineIndex: 0,
    isIndependent: true // 标记为独立节点
  },
  connections: [] // 独立节点，不连接到探索节点
}
```

### 布局算法
1. 识别主线和分支节点
2. 计算分支水平线数量
3. 为每个分支分配水平线索引
4. 在各自水平线上布局节点
5. 计算连接关系（只计算同一分支内的连接）

### 连接渲染
1. 主线连接：从左到右的曲线
2. 分支内连接：同一水平线上的直线
3. 无探索连接：探索节点不再连接到分支节点

## 优势

1. **独立性**：每个分支节点都是独立的，可以继续发展
2. **灵活性**：支持无限的分支嵌套和扩展
3. **清晰性**：明确的视觉分离和标识
4. **可扩展性**：每个分支都可以继续创建新的分支

## 注意事项

1. 分支节点不再连接到探索节点
2. 每个分支节点都可以继续创建新的探索节点
3. 分支的独立性使得故事结构更加灵活
4. 建议合理控制分支数量，避免过于复杂的结构

## 与之前版本的区别

### 移除的功能
- 合并分支功能已移除
- 探索节点不再连接到分支节点
- 分支节点不再依赖于探索节点

### 新增的功能
- 分支节点完全独立
- 每个分支节点都可以继续创建新的探索节点
- 支持无限的分支嵌套

### 改进的功能
- 更清晰的视觉分离
- 更灵活的故事结构
- 更好的用户体验 